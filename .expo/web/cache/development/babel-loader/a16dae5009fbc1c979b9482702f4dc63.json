{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"D:\\\\WorkSpace\\\\Web Projects\\\\Ad-rebate\\\\Screens\\\\ShareCoupons.js\";\nimport \"react-native-gesture-handler\";\nimport React, { useState, useContext, useEffect } from \"react\";\nimport { Picker } from \"@react-native-picker/picker\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport StatusBar from \"react-native-web/dist/exports/StatusBar\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Share from \"react-native-web/dist/exports/Share\";\nimport { db } from \"../firebases\";\nimport { AuthContext } from \"../routes/AuthProvider\";\nexport default function ProfileScreen(_ref) {\n  var _this = this;\n\n  var navigation = _ref.navigation;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      phoneNumber = _useState2[0],\n      setPhoneNumber = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      disabled = _useState4[0],\n      setDisabled = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      errorText = _useState6[0],\n      setErrorText = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      selectedCoupon = _useState8[0],\n      setSelectedCoupon = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      coupons = _useState10[0],\n      setCoupons = _useState10[1];\n\n  var _useState11 = useState(),\n      _useState12 = _slicedToArray(_useState11, 2),\n      shareUser = _useState12[0],\n      setShareUser = _useState12[1];\n\n  var _useState13 = useState(\"Play Store Link\"),\n      _useState14 = _slicedToArray(_useState13, 2),\n      shareMessage = _useState14[0],\n      setShareMessage = _useState14[1];\n\n  var _useContext = useContext(AuthContext),\n      user = _useContext.user,\n      setUserData = _useContext.setUserData,\n      setBannerData = _useContext.setBannerData,\n      userData = _useContext.userData;\n\n  var checkingPhoneNumber = function checkingPhoneNumber(phoneNumber) {\n    return _regeneratorRuntime.async(function checkingPhoneNumber$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            phoneNumber = phoneNumber.replace(\".\", \"\");\n\n            if (phoneNumber.length != 10 || phoneNumber.length == 0 || isNaN(phoneNumber)) {\n              setPhoneNumber(phoneNumber);\n              setDisabled(true);\n              setErrorText(\"Enter the 10 digit number\");\n            } else {\n              setPhoneNumber(\"+91\" + phoneNumber);\n              setDisabled(false);\n              setErrorText(null);\n            }\n\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    if (user) {\n      setShareMessage(\"Ad-Rebate\\n\\nReferral Id - \\n\" + user.uid + \"\\n\\nuse this Id to get Coupon\\n\\n\" + \"https://play.google.com/store/apps/details?id=\" + \"appPackageName\");\n    }\n  }, []);\n\n  var onShare = function onShare() {\n    var result;\n    return _regeneratorRuntime.async(function onShare$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(Share.share({\n              message: shareMessage\n            }));\n\n          case 3:\n            result = _context2.sent;\n\n            if (result.action === Share.sharedAction) {\n              if (result.activityType) {} else {}\n            } else if (result.action === Share.dismissedAction) {}\n\n            _context2.next = 10;\n            break;\n\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2[\"catch\"](0);\n            alert(_context2.t0.message);\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  useEffect(function () {\n    if (user === null) return;\n\n    function temp() {\n      var current, x, d;\n      return _regeneratorRuntime.async(function temp$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              current = new Date();\n              x = current.getHours() < 10 ? \"0\" : \"\" + current.getHours() + \"-\" + current.getMinutes() < 10 ? \"0\" : \"\" + current.getMinutes();\n              d = (current.getDate() < 10 ? \"0\" : \"\") + current.getDate() + \"-\" + (current.getMonth() + 1 < 10 ? \"0\" : \"\") + (current.getMonth() + 1) + \"-\" + current.getFullYear();\n              db.collectionGroup(\"Coupons\").where(\"allotedTo\", \"==\", user.uid).where(\"isRedeemed\", \"==\", false).where(\"expiryDateMs\", \">=\", Date.parse(current)).get().then(function (snap) {\n                snap.forEach(function (doc) {\n                  var aa = new Date();\n                  if (doc.data().activeFrom <= Date.parse(aa)) setCoupons(function (prev) {\n                    return [].concat(_toConsumableArray(prev), [doc.data()]);\n                  });\n                });\n              }).catch(function (err) {\n                console.log(err);\n              });\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n\n    temp();\n  }, [user]);\n  useEffect(function () {\n    if (coupons.length < 1) {\n      return;\n    }\n\n    setSelectedCoupon(coupons[0]);\n  }, [coupons]);\n\n  var shareCouponChecking = function shareCouponChecking() {\n    var tempUser;\n    return _regeneratorRuntime.async(function shareCouponChecking$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (coupons != null) {\n              tempUser = [];\n              db.collection(\"Users\").where(\"phone\", \"==\", phoneNumber).get().then(function (res) {\n                res.forEach(function (user) {\n                  tempUser.push(user.data());\n                });\n              }).then(function () {\n                db.collection(\"ClientData\").doc(selectedCoupon.client).collection(\"Coupons\").doc(selectedCoupon.id).set({\n                  allotedTo: tempUser[0].id\n                }, {\n                  merge: true\n                }).then(function () {\n                  return navigation.popToTop();\n                }, console.log(\"done\"), Alert.alert(\"Coupon Shared\")).catch(function (err) {\n                  console.log(err);\n                });\n              }).catch(function (error) {\n                Alert.alert(\"Not a Valdi user in Ad-Rebate\");\n                console.log(\"Not a valid User \", error);\n              });\n            }\n\n          case 1:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 5\n    }\n  }, React.createElement(StatusBar, {\n    backgroundColor: \"black\",\n    barStyle: \"light-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }\n  }), React.createElement(TextInput, {\n    style: styles.textinput,\n    placeholder: \"Phone no.\",\n    placeholderTextColor: \"#EDEDED\",\n    keyboardAppearance: \"dark\",\n    keyboardType: \"phone-pad\",\n    color: \"#fff\",\n    onChangeText: checkingPhoneNumber,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }\n  }), React.createElement(Text, {\n    style: styles.erText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 8\n    }\n  }, errorText), coupons.length > 0 ? React.createElement(View, {\n    style: styles.picker,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 9\n    }\n  }, React.createElement(Picker, {\n    style: {\n      color: \"white\",\n      fontSize: 12\n    },\n    dropdownIconColor: \"gray\",\n    onValueChange: function onValueChange(itemValue, itemIndex) {\n      console.log(\"ote,\" + itemValue);\n      setSelectedCoupon(itemValue);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 11\n    }\n  }, coupons.map(function (item) {\n    return React.createElement(Picker.Item, {\n      style: styles.pickerItem,\n      label: item.clientName + \" - discount upto : \" + item.userDiscount5 + \"%\",\n      value: item,\n      key: item.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }\n    });\n  }))) : React.createElement(View, {\n    style: styles.erText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  }, React.createElement(Text, {\n    style: {\n      color: \"#920000\",\n      fontFamily: \"Poppins-Regular\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 11\n    }\n  }, \"You do not have any coupon for this store\")), React.createElement(Button, {\n    title: \"Share\",\n    onPress: shareCouponChecking,\n    disabled: disabled,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 7\n    }\n  }), React.createElement(Button, {\n    title: \"Refer And Earn\",\n    onPress: onShare,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 7\n    }\n  }), React.createElement(Button, {\n    title: \"Go Home\",\n    onPress: function onPress() {\n      return navigation.popToTop();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }\n  }));\n}\nvar styles = StyleSheet.create({\n  textinput: {\n    backgroundColor: \"#1A1A1A\",\n    borderColor: \"#424242\",\n    borderWidth: 1,\n    borderRadius: 20,\n    paddingLeft: 20,\n    paddingRight: 20,\n    width: \"80%\",\n    height: 61,\n    alignSelf: \"center\",\n    fontSize: 18,\n    fontFamily: \"Poppins-Regular\",\n    marginBottom: 24\n  },\n  erText: {\n    color: \"red\",\n    width: \"75%\",\n    alignSelf: \"center\",\n    marginTop: -18\n  },\n  picker: {\n    backgroundColor: \"#252525\",\n    borderColor: \"#424242\",\n    color: \"#ffffff\",\n    borderWidth: 1,\n    borderRadius: 50,\n    paddingLeft: 20,\n    width: \"80%\",\n    height: 50,\n    alignSelf: \"center\",\n    fontSize: 12,\n    fontFamily: \"Poppins-Regular\",\n    marginBottom: 24\n  },\n  pickerItem: {\n    color: \"white\",\n    fontFamily: \"Poppins-Regular\",\n    backgroundColor: \"#252525\",\n    borderRadius: 10,\n    width: \"80%\",\n    height: 50,\n    textAlign: \"center\",\n    marginBottom: 10\n  }\n});","map":{"version":3,"sources":["D:/WorkSpace/Web Projects/Ad-rebate/Screens/ShareCoupons.js"],"names":["React","useState","useContext","useEffect","Picker","db","AuthContext","ProfileScreen","navigation","phoneNumber","setPhoneNumber","disabled","setDisabled","errorText","setErrorText","selectedCoupon","setSelectedCoupon","coupons","setCoupons","shareUser","setShareUser","shareMessage","setShareMessage","user","setUserData","setBannerData","userData","checkingPhoneNumber","replace","length","isNaN","uid","onShare","Share","share","message","result","action","sharedAction","activityType","dismissedAction","alert","temp","current","Date","x","getHours","getMinutes","d","getDate","getMonth","getFullYear","collectionGroup","where","parse","get","then","snap","forEach","doc","aa","data","activeFrom","prev","catch","err","console","log","shareCouponChecking","tempUser","collection","res","push","client","id","set","allotedTo","merge","popToTop","Alert","error","styles","container","textinput","erText","picker","color","fontSize","itemValue","itemIndex","map","item","pickerItem","clientName","userDiscount5","fontFamily","StyleSheet","create","backgroundColor","borderColor","borderWidth","borderRadius","paddingLeft","paddingRight","width","height","alignSelf","marginBottom","marginTop","textAlign"],"mappings":"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","sourcesContent":["import \"react-native-gesture-handler\";\r\nimport React, { useState, useContext, useEffect } from \"react\";\r\nimport { Picker } from \"@react-native-picker/picker\";\r\nimport {\r\n  Button,\r\n  View,\r\n  Text,\r\n  TextInput,\r\n  StyleSheet,\r\n  StatusBar,\r\n  Alert,\r\n  Share,\r\n} from \"react-native\";\r\nimport { db } from \"../firebases\";\r\nimport { AuthContext } from \"../routes/AuthProvider\";\r\n\r\nexport default function ProfileScreen({ navigation }) {\r\n  const [phoneNumber, setPhoneNumber] = useState();\r\n  const [disabled, setDisabled] = useState(true);\r\n  const [errorText, setErrorText] = useState(\"\");\r\n  const [selectedCoupon, setSelectedCoupon] = useState(null);\r\n  const [coupons, setCoupons] = useState([]);\r\n  const [shareUser, setShareUser] = useState();\r\n  const [shareMessage, setShareMessage] = useState(\"Play Store Link\");\r\n  const { user, setUserData, setBannerData, userData } = useContext(\r\n    AuthContext\r\n  );\r\n\r\n  const checkingPhoneNumber = async (phoneNumber) => {\r\n    phoneNumber = phoneNumber.replace(\".\", \"\");\r\n    if (\r\n      phoneNumber.length != 10 ||\r\n      phoneNumber.length == 0 ||\r\n      isNaN(phoneNumber)\r\n    ) {\r\n      setPhoneNumber(phoneNumber);\r\n      setDisabled(true);\r\n      setErrorText(\"Enter the 10 digit number\");\r\n    } else {\r\n      setPhoneNumber(\"+91\" + phoneNumber);\r\n      setDisabled(false);\r\n      setErrorText(null);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      setShareMessage(\r\n        \"Ad-Rebate\\n\\nReferral Id - \\n\" +\r\n          user.uid +\r\n          \"\\n\\nuse this Id to get Coupon\\n\\n\" +\r\n          \"https://play.google.com/store/apps/details?id=\" +\r\n          \"appPackageName\"\r\n      );\r\n    }\r\n  }, []);\r\n  const onShare = async () => {\r\n    try {\r\n      const result = await Share.share({\r\n        message: shareMessage,\r\n      });\r\n      if (result.action === Share.sharedAction) {\r\n        if (result.activityType) {\r\n          // shared with activity type of result.activityType\r\n        } else {\r\n          // shared\r\n        }\r\n      } else if (result.action === Share.dismissedAction) {\r\n        // dismissed\r\n      }\r\n    } catch (error) {\r\n      alert(error.message);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user === null) return;\r\n    async function temp() {\r\n      var current = new Date();\r\n      const x =\r\n        current.getHours() < 10\r\n          ? \"0\"\r\n          : \"\" + current.getHours() + \"-\" + current.getMinutes() < 10\r\n          ? \"0\"\r\n          : \"\" + current.getMinutes();\r\n      //console.log(x);\r\n      const d =\r\n        (current.getDate() < 10 ? \"0\" : \"\") +\r\n        current.getDate() +\r\n        \"-\" +\r\n        (current.getMonth() + 1 < 10 ? \"0\" : \"\") +\r\n        (current.getMonth() + 1) +\r\n        \"-\" +\r\n        current.getFullYear();\r\n      db.collectionGroup(\"Coupons\")\r\n        .where(\"allotedTo\", \"==\", user.uid)\r\n        .where(\"isRedeemed\", \"==\", false)\r\n        .where(\"expiryDateMs\", \">=\", Date.parse(current))\r\n        .get()\r\n        .then((snap) => {\r\n          snap.forEach((doc) => {\r\n            var aa = new Date();\r\n            if (doc.data().activeFrom <= Date.parse(aa))\r\n              setCoupons((prev) => [...prev, doc.data()]);\r\n          });\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n    }\r\n    temp();\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    if (coupons.length < 1) {\r\n      return;\r\n    }\r\n    //console.log(\"ccc\");\r\n    //console.log(coupons);\r\n    setSelectedCoupon(coupons[0]);\r\n  }, [coupons]);\r\n\r\n  //console.log(coupons);\r\n  const shareCouponChecking = async () => {\r\n    if (coupons != null) {\r\n      const tempUser = [];\r\n      db.collection(\"Users\")\r\n        .where(\"phone\", \"==\", phoneNumber)\r\n        .get()\r\n        .then((res) => {\r\n          res.forEach((user) => {\r\n            tempUser.push(user.data());\r\n          });\r\n          //console.log(tempUser);\r\n          //console.log(selectedCoupon);\r\n        })\r\n        .then(() => {\r\n          db.collection(\"ClientData\")\r\n            .doc(selectedCoupon.client)\r\n            .collection(\"Coupons\")\r\n            .doc(selectedCoupon.id)\r\n            .set({ allotedTo: tempUser[0].id }, { merge: true })\r\n            .then(\r\n              () => navigation.popToTop(),\r\n              console.log(\"done\"),\r\n              Alert.alert(\"Coupon Shared\")\r\n            )\r\n            .catch((err) => {\r\n              console.log(err);\r\n            });\r\n        })\r\n        .catch(function (error) {\r\n          Alert.alert(\"Not a Valdi user in Ad-Rebate\");\r\n          console.log(\"Not a valid User \", error);\r\n        });\r\n    }\r\n  };\r\n  return (\r\n    <View style={styles.container}>\r\n      <StatusBar backgroundColor=\"black\" barStyle=\"light-content\" />\r\n      <TextInput\r\n        style={styles.textinput}\r\n        placeholder=\"Phone no.\"\r\n        placeholderTextColor=\"#EDEDED\"\r\n        keyboardAppearance=\"dark\"\r\n        keyboardType=\"phone-pad\"\r\n        color=\"#fff\"\r\n        onChangeText={checkingPhoneNumber}\r\n      ></TextInput>\r\n      {<Text style={styles.erText}>{errorText}</Text>}\r\n      {coupons.length > 0 ? (\r\n        <View style={styles.picker}>\r\n          <Picker\r\n            style={{\r\n              color: \"white\",\r\n              fontSize: 12,\r\n            }}\r\n            dropdownIconColor=\"gray\"\r\n            onValueChange={(itemValue, itemIndex) => {\r\n              console.log(\"ote,\" + itemValue);\r\n              setSelectedCoupon(itemValue);\r\n            }}\r\n          >\r\n            {coupons.map((item) => {\r\n              return (\r\n                <Picker.Item\r\n                  style={styles.pickerItem}\r\n                  label={\r\n                    item.clientName +\r\n                    \" - discount upto : \" +\r\n                    item.userDiscount5 +\r\n                    \"%\"\r\n                  }\r\n                  value={item}\r\n                  key={item.id}\r\n                />\r\n              );\r\n            })}\r\n          </Picker>\r\n        </View>\r\n      ) : (\r\n        <View style={styles.erText}>\r\n          <Text style={{ color: \"#920000\", fontFamily: \"Poppins-Regular\" }}>\r\n            You do not have any coupon for this store\r\n          </Text>\r\n        </View>\r\n      )}\r\n      <Button title=\"Share\" onPress={shareCouponChecking} disabled={disabled} />\r\n      <Button title=\"Refer And Earn\" onPress={onShare} />\r\n      <Button title=\"Go Home\" onPress={() => navigation.popToTop()} />\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  textinput: {\r\n    backgroundColor: \"#1A1A1A\",\r\n    borderColor: \"#424242\",\r\n    borderWidth: 1,\r\n    borderRadius: 20,\r\n    paddingLeft: 20,\r\n    paddingRight: 20,\r\n    width: \"80%\",\r\n    height: 61,\r\n    alignSelf: \"center\",\r\n    fontSize: 18,\r\n    fontFamily: \"Poppins-Regular\",\r\n    marginBottom: 24,\r\n  },\r\n  erText: {\r\n    color: \"red\",\r\n    width: \"75%\",\r\n    alignSelf: \"center\",\r\n    marginTop: -18,\r\n  },\r\n  picker: {\r\n    backgroundColor: \"#252525\",\r\n    borderColor: \"#424242\",\r\n    color: \"#ffffff\",\r\n    borderWidth: 1,\r\n    borderRadius: 50,\r\n    paddingLeft: 20,\r\n    width: \"80%\",\r\n    height: 50,\r\n    alignSelf: \"center\",\r\n    fontSize: 12,\r\n    fontFamily: \"Poppins-Regular\",\r\n    marginBottom: 24,\r\n  },\r\n  pickerItem: {\r\n    color: \"white\",\r\n    fontFamily: \"Poppins-Regular\",\r\n    backgroundColor: \"#252525\",\r\n    borderRadius: 10,\r\n    width: \"80%\",\r\n    height: 50,\r\n    textAlign: \"center\",\r\n    marginBottom: 10,\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}